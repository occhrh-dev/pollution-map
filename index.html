<!DOCTYPE html>
<html>
  <head>
    <title>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏°‡∏•‡∏û‡∏¥‡∏©‡πÅ‡∏ö‡∏ö‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: sans-serif;
  }
  #map {
    height: calc(100vh - 180px);
    width: 100%;
  }
  #controls {
    padding: 10px;
    background: #f0f0f0;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }
  input, button, label, select {
    padding: 5px;
    font-size: 16px;
  }
  input[type="number"] {
    width: 100px;
  }
  #communitySelect {
    width: 100%;
    min-width: 400px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ */
}
  .gm-style .community-label {
    text-shadow: 1px 1px 2px #000;
  }

  /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
  .gm-style .radius-label {
    background-color: white;
    border-radius: 8px;
    padding: 4px 10px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    color: black;
    font-weight: bold;
    font-size: 18px;
    white-space: nowrap;
  }
</style>
    <!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  </head>
 <script>
$(document).ready(function() {
  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Select2
  $('#communitySelect').select2({
    placeholder: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∏‡∏°‡∏ä‡∏ô...",
    width: 'resolve'
  });

  // ‚úÖ Checkbox: ‡πÅ‡∏™‡∏î‡∏á layout ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  $('#showAllLayoutsToggle').on('change', function () {
    const checked = $(this).is(':checked');
    for (const name in communityFeatures) {
      const feature = communityFeatures[name];
      map.data.overrideStyle(feature, { visible: checked });
    }
  });

  // ‚úÖ Dropdown: ‡∏•‡∏ö label ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
  $('#communitySelect').on('change', function () {
    const selected = $(this).val() || [];

    // ‡∏•‡∏ö label ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    for (const name in labelMarkers) {
      if (!selected.includes(name)) {
        labelMarkers[name].setMap(null);
        delete labelMarkers[name];
      }
    }

    // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á layout ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏ñ‡πâ‡∏≤ checkbox ‚Äú‡πÅ‡∏™‡∏î‡∏á polygon ‡∏î‡πâ‡∏ß‡∏¢‚Äù ‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡πä‡∏Å
    const showPolygon = $('#showPolygonToggle').is(':checked');
    for (const name in communityFeatures) {
      const feature = communityFeatures[name];
      const shouldShow = selected.includes(name) && showPolygon;
      map.data.overrideStyle(feature, { visible: shouldShow });
    }
  });

  // ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á dropdown
  $('#clearCommunities').on('click', function () {
    $('#communitySelect').val(null).trigger('change');

    for (const name in labelMarkers) {
      labelMarkers[name].setMap(null);
    }
    labelMarkers = {};
  });
});
</script>

  <body>
    <div id="controls">
      <label for="radiusInput">‡∏£‡∏±‡∏®‡∏°‡∏µ (‡πÄ‡∏°‡∏ï‡∏£):</label>
      <input type="number" id="radiusInput" value="1000" min="100" step="100">
      <label for="colorInput">‡∏™‡∏µ:</label>
      <input type="color" id="colorInput" value="#FF0000">
      <label><input type="checkbox" id="fillToggle" checked> ‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏µ‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô</label>
      <button onclick="undoLast()">Undo</button>
      <button onclick="clearMap()">‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</button>
      <label>‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î:</label>
      <input type="number" id="latInput" step="0.000001" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12.738">
      <label>‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î:</label>
      <input type="number" id="lngInput" step="0.000001" placeholder="‡πÄ‡∏ä‡πà‡∏ô 101.185">
      <button onclick="addPointFromInput()">‡∏•‡∏á‡∏à‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î</button>
      <label for="communitySelect">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏°‡∏ä‡∏ô:</label>
      <select id="communitySelect" multiple onchange="showSelectedLayouts(); showSelectedCommunities();">
    </select>
      <button onclick="showAllCommunities()">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      <button id="clearCommunities">‡∏•‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      <label><input type="checkbox" id="showAllLayoutsToggle"> ‡πÅ‡∏™‡∏î‡∏á layout ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label>
      <label><input type="checkbox" id="showPolygonToggle" checked> ‡πÅ‡∏™‡∏î‡∏á polygon ‡∏î‡πâ‡∏ß‡∏¢</label>
  </div>

    <div id="map"></div>

    <script>
      let map;
      let circles = [];
      let markers = [];
      let communityFeatures = {};
      let labelMarkers = {};
      let radiusLabels = [];
      let communityLabels = {};

function drawCircle(latLng) {
  const radius = parseInt(document.getElementById("radiusInput").value) || 1000;
  const color = document.getElementById("colorInput").value;
  const fillOpacity = document.getElementById("fillToggle").checked ? 0.35 : 0;

  // üü¢ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏á‡∏£‡∏±‡∏®‡∏°‡∏µ
  const circle = new google.maps.Circle({
    strokeColor: color,
    strokeOpacity: 0.8,
    strokeWeight: 4,
    fillColor: color,
    fillOpacity: fillOpacity,
    map,
    center: latLng,
    radius: radius,
    clickable: false
  });
  circles.push(circle);

// üîµ ‡∏™‡∏£‡πâ‡∏≤‡∏á marker ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏∏‡∏î
const starPath = "M 0,-15 L 4,-4 L 15,-4 L 6,2 L 9,12 L 0,6 -9,12 -6,2 -15,-4 -4,-4 Z";

const marker = new google.maps.Marker({
  position: latLng,
  map: map,
  icon: {
    path: starPath,
    scale: 1.5,
    fillColor: "#FFD700",      // ‡∏™‡∏µ‡∏ó‡∏≠‡∏á
    fillOpacity: 1,
    strokeWeight: 1,
    strokeColor: "#333"
  }
});

markers.push(marker);

  // üè∑ ‡∏™‡∏£‡πâ‡∏≤‡∏á label ‡∏£‡∏∞‡∏¢‡∏∞‡∏£‡∏±‡∏®‡∏°‡∏µ (‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏ß‡∏á)
  const kmText = Math.round(radius / 1000) + " ‡∏Å‡∏°.";
  const offsetFactor = radius / 140000; // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏°‡∏ï‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏á‡∏®‡∏≤‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
  const offsetLat = latLng.lat() - offsetFactor;
  const offsetLng = latLng.lng() - offsetFactor;
  const offsetPosition = new google.maps.LatLng(offsetLat, offsetLng);

  const radiusLabel = new google.maps.Marker({
    position: offsetPosition,
    map: map,
    label: {
      text: kmText,
      fontSize: "14px",
      fontWeight: "bold",
      color: "#000000",
      className: "radius-label"
    },
    icon: {
      path: google.maps.SymbolPath.CIRCLE,
      scale: 0
    }
  });
  radiusLabels.push(radiusLabel);
}


      function addPointFromInput() {
        const lat = parseFloat(document.getElementById("latInput").value);
        const lng = parseFloat(document.getElementById("lngInput").value);
        if (!isNaN(lat) && !isNaN(lng)) {
          drawCircle(new google.maps.LatLng(lat, lng));
        } else {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        }
      }

      function getPolygonCentroid(path) {
        let area = 0, x = 0, y = 0;
        const len = path.getLength();
        for (let i = 0; i < len; i++) {
          const p1 = path.getAt(i);
          const p2 = path.getAt((i + 1) % len);
          const f = p1.lat() * p2.lng() - p2.lat() * p1.lng();
          area += f;
          x += (p1.lat() + p2.lat()) * f;
          y += (p1.lng() + p2.lng()) * f;
        }
        area *= 0.5;
        x /= (6 * area);
        y /= (6 * area);
        return new google.maps.LatLng(x, y);
      }

      function updateLabelSizes() {
        const zoom = map.getZoom();
        const fontSize = Math.max(10, Math.min(zoom * 1.2, 24)) + "px";

        Object.values(labelMarkers).forEach(marker => {
          const label = marker.getLabel();
          if (label) {
            marker.setLabel({
              ...label,
              fontSize: fontSize
            });
          }
        });
      }

    function showSelectedCommunities() {
  const selected = $('#communitySelect').val() || [];

  // ‚úÖ ‡∏•‡∏ö label ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
  for (const name in labelMarkers) {
    if (!selected.includes(name)) {
      labelMarkers[name].setMap(null);
      delete labelMarkers[name];
    }
  }

  // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á label ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
  selected.forEach(name => {
    if (labelMarkers[name]) return;

    const feature = communityFeatures[name];
    if (!feature) return;

    const geometry = feature.getGeometry();
    let center;

    if (geometry.getType() === 'Polygon') {
      center = getPolygonCentroid(geometry.getAt(0));
    } else if (geometry.getType() === 'MultiPolygon') {
      center = getPolygonCentroid(geometry.getAt(0).getAt(0));
    }

    if (center) {
      const labelMarker = new google.maps.Marker({
        position: center,
        map: map,
        label: {
          text: name,
          fontSize: "14px",
          fontWeight: "bold",
          color: "#FFFFFF",
          className: "community-label"
        },
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 0
        }
      });
      labelMarkers[name] = labelMarker;
      updateLabelSizes();
    }
  });
}

     function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 12.738, lng: 101.185 },
    zoom: 12,
    styles: [
      { featureType: "poi", stylers: [{ visibility: "off" }] },
      { featureType: "transit", stylers: [{ visibility: "off" }] },
      { featureType: "road", elementType: "labels", stylers: [{ visibility: "off" }] },
      { featureType: "administrative", elementType: "labels", stylers: [{ visibility: "off" }] }
    ]
  });

  map.data.loadGeoJson('‡∏ú‡∏±‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏Ç‡∏ï‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏°‡∏•‡∏û‡∏¥‡∏©.json');

  map.data.setStyle(feature => ({
    fillColor: feature.getProperty('fill') || '#FF0000',
    fillOpacity: feature.getProperty('fill-opacity') || 0.3,
    strokeColor: feature.getProperty('stroke') || '#FF0000',
    strokeWeight: feature.getProperty('stroke-width') || 2
  }));

  map.data.addListener("addfeature", function(event) {
    const feature = event.feature;
    const name = feature.getProperty("name");
    if (name) {
      communityFeatures[name] = feature;

      // ‚úÖ ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô
      map.data.overrideStyle(feature, { visible: false });

      const option = document.createElement("option");
      option.value = name;
      option.textContent = name;
      document.getElementById("communitySelect").appendChild(option);
    }
  });

  map.data.addListener("click", (event) => {
    if (event.latLng) {
      drawCircle(event.latLng);
    }
  });

  map.addListener("click", (e) => {
    drawCircle(e.latLng);
  });

  map.addListener("zoom_changed", updateLabelSizes); // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î label ‡∏ï‡∏≤‡∏° zoom
}

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å initMap ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏Ñ‡∏£‡∏ö
function showSelectedLayouts() {
  const selected = $('#communitySelect').val() || [];
  const showPolygon = $('#showPolygonToggle').is(':checked');
  const showAllLayouts = $('#showAllLayoutsToggle').is(':checked');

  for (const name in communityFeatures) {
    const feature = communityFeatures[name];
    let shouldShow = false;
    if (showAllLayouts) {
      // ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡πä‡∏Å ‚Äú‡πÅ‡∏™‡∏î‡∏á layout ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚Äù ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å layout ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏ô dropdown
      shouldShow = true;
    } else if (selected.includes(name) && showPolygon) {
      // ‚úÖ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å dropdown ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡πä‡∏Å ‚Äú‡πÅ‡∏™‡∏î‡∏á polygon ‡∏î‡πâ‡∏ß‡∏¢‚Äù ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      shouldShow = true;
    }
    map.data.overrideStyle(feature, { visible: shouldShow });
  }
}
function showAllCommunities() {
  const select = document.getElementById("communitySelect");
  const allValues = Array.from(select.options).map(opt => opt.value);
  $('#communitySelect').val(allValues).trigger('change');
}
      function clearMap() {
        circles.forEach(c => c.setMap(null));
        markers.forEach(m => m.setMap(null));
        Object.values(labelMarkers).forEach(m => m.setMap(null));
        radiusLabels.forEach(l => l.setMap(null));
        circles = [];
        markers = [];
        labelMarkers = {};
        radiusLabels = [];
      }

      function undoLast() {
        if (circles.length > 0) {
          circles.pop().setMap(null);
          markers.pop().setMap(null);
          radiusLabels.pop().setMap(null);
        }
      }
    </script>

    <script async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuVjbyua3vpKU_05o6KSc3zUh7iMYVo4c&callback=initMap">
    </script>
  </






