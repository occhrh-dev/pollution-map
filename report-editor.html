<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ตกแต่งภาพรายงาน</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: sans-serif;
    margin: 0;
    padding: 20px;
    background: #f9f9f9;
  }
  #reportTitle {
    width: 100%;
    font-size: 20px;
    margin-bottom: 10px;
    padding: 8px;
  }
  #canvasContainer {
    position: relative;
    display: inline-block;
  }
  #reportCanvas {
    border: 1px solid #ccc;
    background: white;
  }
  #editorTools {
    margin-top: 10px;
  }
  #editorTools input, #editorTools button {
    margin: 5px;
    padding: 8px;
    font-size: 16px;
  }
</style>
</head>
<body>

<h2>ตกแต่งภาพรายงาน</h2>
<input type="text" id="reportTitle" placeholder="หัวเรื่องรายงาน">
<input type="file" id="imageUpload" accept="image/*">

<div id="canvasContainer">
  <canvas id="reportCanvas" width="800" height="600"></canvas>
</div>

<div id="editorTools">
  <button onclick="addArrow()">เพิ่มทิศทางลม ⟹</button>
  <button onclick="addTextBox()">ใส่ข้อความ</button>
  <label>หมุนลูกศร (องศา):</label>
  <input type="range" id="arrowRotation" min="0" max="360" value="0" 
         oninput="rotateSelectedArrow(this.value)">
  <button onclick="undoLast()">Undo</button>
  <button onclick="exportReport()">บันทึกรายงาน</button>
</div>

<script>
const canvas = document.getElementById("reportCanvas");
const ctx = canvas.getContext("2d");
const titleInput = document.getElementById("reportTitle");
let backgroundImage = null;
let drawHistory = [];   // เก็บการกระทำเพื่อ undo
let arrows = [];        // เก็บลูกศร
let texts = [];         // เก็บกล่องข้อความ
let selectedArrow = null;

// ✅ ใส่ Base64 โลโก้ของคุณตรงนี้
const logoImage = new Image();
logoImage.src = "data:image/png;base64,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";

// อัปโหลดภาพพื้นหลัง
document.getElementById("imageUpload").addEventListener("change", e=>{
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    backgroundImage = new Image();
    backgroundImage.onload = redraw;
    backgroundImage.src = ev.target.result;
  }
  reader.readAsDataURL(file);
});

// ฟังก์ชันวาดใหม่ทุกครั้ง
function redraw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // พื้นหลัง
  if(backgroundImage) ctx.drawImage(backgroundImage,0,0,canvas.width,canvas.height);

  // โลโก้ มุมบนขวา
  if(logoImage.complete){
    const w=120;
    const h= (logoImage.height/logoImage.width)*w;
    ctx.drawImage(logoImage, canvas.width-w-10, 10, w, h);
  }

  // หัวเรื่อง
  ctx.font = "24px sans-serif";
  ctx.fillStyle = "black";
  ctx.fillText(titleInput.value || "", 20, 40);

  // วาดลูกศร
  arrows.forEach(a=>{
    ctx.save();
    ctx.translate(a.x, a.y);
    ctx.rotate(a.angle*Math.PI/180);
    ctx.fillStyle="red";
    ctx.fillRect(-30,-5,60,10);   // ก้าน
    ctx.beginPath();             // หัวลูกศร
    ctx.moveTo(30,0);
    ctx.lineTo(20,10);
    ctx.lineTo(20,-10);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  });

  // วาดข้อความ
  ctx.fillStyle="blue";
  ctx.font="20px sans-serif";
  texts.forEach(t=>{
    ctx.fillText(t.text, t.x, t.y);
  });
}

// เพิ่มลูกศร
function addArrow(){
  arrows.push({x:100,y:100,angle:0});
  drawHistory.push({type:"arrow"});
  redraw();
}

// เพิ่มข้อความ
function addTextBox(){
  const text = prompt("กรอกข้อความ:");
  if(text){
    texts.push({text,x:150,y:150});
    drawHistory.push({type:"text"});
    redraw();
  }
}

// หมุนลูกศรล่าสุด
function rotateSelectedArrow(val){
  if(arrows.length>0){
    arrows[arrows.length-1].angle = parseInt(val);
    redraw();
  }
}

// Undo การกระทำล่าสุด
function undoLast(){
  const last = drawHistory.pop();
  if(!last) return;
  if(last.type==="arrow") arrows.pop();
  else if(last.type==="text") texts.pop();
  redraw();
}

// บันทึกรายงานเป็นภาพ
function exportReport(){
  const link = document.createElement("a");
  link.download = "report.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}

titleInput.addEventListener("input",redraw);
logoImage.onload = redraw;
</script>
</body>
</html>
